---
title: "Tugas Praktikum 6 "
author: "DIANI RARAS PUSPITA"
date: "2025-10-09"
output: html_document
---

```{r}
library(ggplot2)
library(tsibble)
library(tseries)
library(MASS)
set.seed(8990)
```

## Masukan Data

```{r}
data <- data.frame(
  waktu = 376:500,
  nilai = c(14367,14454,14506,14495,14666,
            14672,14521,14432,14609,14839,
            14817,14975,14977,14996,14974,
            14778,14945,14636,14837,14826,
            14867,14824,14994,15089,15303,
            15285,15462,15522,15549,15610,
            15474,15629,15675,15362,15582,
            15616,15566,15509,15602,15115,
            15056,14970,15079,15182,15159,
            15258,15255,15473,15369,15165,
            14969,14934,14783,14929,14666,
            14668,14843,14929,15008,14875,
            14886,14954,15043,15036,15158,
            14996,15041,15095,15139,15324,
            15314,15291,15194,15379,15360,
            15346,15487,15636,15696,15864,
            15904,15582,15683,15399,15447,
            15399,15560,15283,15409,15383,
            15478,15503,15601,15768,15727,
            15598,15629,15586,15692,15536,
            15639,15803,15873,15883,16112,
            16210,16232,15951,16047,15920,
            16038,16244,16268,16480,16470,
            16343,16239,16067,16208,16284,
            16135,15934,15672,15484,15649)
)

head(data)

```

```{r}
ggplot(data, aes(x=waktu, y=nilai)) +
  geom_line(color="blue") +
  geom_point(color="darkred") +
  labs(title="Plot Data Time Series Asli",
       x="Waktu", y="Nilai")

```


## Cek Stasioneritas
### Plot ACF dan PACF

```{r}
acf(data$nilai, main="ACF Data Asli")
pacf(data$nilai, main="PACF Data Asli")

```



Dari hasil plot ACF dan PACF pada data asli, terlihat bahwa nilai **ACF menurun secara perlahan (decay lambat)** dan tidak langsung putus pada lag awal. Hal ini mengindikasikan bahwa data memiliki tren dan **belum stasioner dalam rataan (mean)**.  

PACF menunjukkan spike signifikan pada lag 1 dan menurun setelahnya. Pola seperti ini juga mendukung kesimpulan bahwa **data masih mengandung komponen non-stasioner**.  

Dengan demikian, diperlukan proses **differencing** untuk membuat data menjadi stasioner sebelum dilakukan pemodelan lebih lanjut.


### Uji Augmented Dickey-Fuller (ADF)

```{r}
adf.test(data$nilai)
```
Nilai p-value diperoleh 0.3662, maka p-value > 0.05 → *Data tidak stasioner.*

**Data asli** menunjukkan pola tren, ACF yang turun lambat, serta hasil uji ADF dengan p-value > 0.05. Hal ini mengindikasikan bahwa data **belum stasioner dalam rataan** meskipun ragam relatif stabil.

## Penanganan 
### Differencing Orde 1

```{r}
diff_data <- diff(data$nilai, differences=1)

plot.ts(diff_data, main="Data Setelah Differencing (d=1)")
acf(diff_data, main="ACF Setelah Differencing")
pacf(diff_data, main="PACF Setelah Differencing")

adf.test(diff_data)

```
### Uji Stasioneritas Setelah Differencing

Setelah dilakukan differencing orde 1, hasil uji menunjukkan bahwa data sudah stasioner:


- ACF cepat turun menuju nol, tidak seperti pada data asli.
- PACF tidak menunjukkan pola yang kuat.
- Uji Augmented Dickey-Fuller memberikan nilai p-value = 0.01 (< 0.05), sehingga hipotesis nol (data tidak stasioner) ditolak.Hal ini berarti data telah **stasioner dalam rataan**.
- Plot setelah differencing juga memperlihatkan variabilitas yang relatif konstan, sehingga dapat disimpulkan bahwa data sudah **stasioner dalam rataan dan ragam**.


**Kesimpulan:** Data telah stasioner setelah dilakukan differencing orde 1, sehingga dapat digunakan untuk proses pemodelan lebih lanjut (misalnya ARIMA).


## Pendugaan Parameter Model

Karena data telah stasioner setelah differencing orde 1, maka parameter **d = 1**.  
Berdasarkan pola ACF dan PACF, dicoba beberapa kombinasi orde ARIMA yaitu (1,1,0), (0,1,1), dan (1,1,1).  
Pendugaan parameter dilakukan menggunakan metode **Maximum Likelihood (ML)**.

Nilai **AIC (Akaike Information Criterion)** dari masing-masing model digunakan untuk membandingkan mana yang paling baik.  
Model dengan **AIC terkecil** akan dipilih sebagai model terbaik untuk data ini.

```{r}
#---SETUP---
library(forecast)   # berisi fungsi Arima()
library(lmtest)     # buat coeftest()
```

```{r}
# Membentuk data training
data.train <- data$nilai

# Model 1: ARIMA(0,1,1)
model1 <- Arima(data.train, order=c(0,1,1), method="ML")
summary(model1) # lihat nilai AIC
```

```{r}
lmtest::coeftest(model1) # cek signifikansi parameter
```

```{r}
# Model 2: ARIMA(1,1,0)
model2 <- Arima(data.train, order=c(1,1,0), method="ML")
summary(model2) # lihat nilai AIC
```

```{r}
lmtest::coeftest(model2) # cek signifikansi parameter
```

```{r}
# Model 3: ARIMA(1,1,1)
model3 <- Arima(data.train, order=c(1,1,1), method="ML")
summary(model3) # lihat nilai AIC
```

```{r}
lmtest::coeftest(model3) # cek signifikansi parameter
```

```{r}
# Model 4: ARIMA(2,1,2)
model4 <- Arima(data.train, order=c(2,1,2), method="ML")
summary(model4) # lihat nilai AIC
```

```{r}
lmtest::coeftest(model4) # cek signifikansi parameter
```

```{r}
# Model 5: ARIMA(0,1,2)
model5 <- Arima(data.train, order=c(0,1,2), method="ML")
summary(model5)
```

```{r}
lmtest::coeftest(model5)
```


```{r}
#---PERBANDINGAN NILAI AIC DAN BIC---

hasil_model <- data.frame(
  Model = c("ARIMA(0,1,1)",
            "ARIMA(1,1,0)",
            "ARIMA(1,1,1)",
            "ARIMA(2,1,2)",
            "ARIMA(0,1,2)"),
  
  AIC = c(
    AIC(model1),
    AIC(model2),
    AIC(model3),
    AIC(model4),
    AIC(model5)
  ),
  
  BIC = c(
    BIC(model1),
    BIC(model2),
    BIC(model3),
    BIC(model4),
    BIC(model5)
  )
)

hasil_model

```
Berdasarkan hasil pendugaan parameter di atas, diperoleh bahwa nilai **AIC terkecil dimiliki oleh model ARIMA(1,1,1)** dengan nilai AIC = 1585.505.  
Selain itu, hasil uji signifikansi parameter menunjukkan bahwa seluruh parameter pada model ARIMA(1,1,1) signifikan secara statistik.  

Dengan demikian, **model terbaik yang dipilih adalah ARIMA(1,1,1)** karena memiliki nilai AIC paling kecil dan parameter yang signifikan.

## Analisis Sisaan
### Eksplorasi Sisaan

```{r}
#---EKSPLORASI SISAAN---

sisaan.arima111 <- model3$residuals
par(mfrow=c(2,2))

#qqnorm(sisaan.arima111)
#qqline(sisaan.arima111, col = "blue", lwd = 2)
car::qqPlot(sisaan.arima111)

plot(c(1:length(sisaan.arima111)), sisaan.arima111, 
     main="Plot Sisaan ARIMA(1,1,1)", 
     ylab="Residuals", xlab="Index", type="l", col="blue")

# ACF dan PACF sisaan
acf(sisaan.arima111, main="ACF Sisaan ARIMA(1,1,1)")
pacf(sisaan.arima111, main="PACF Sisaan ARIMA(1,1,1)")

```
Berdasarkan plot kuantil-kuantil normal, secara eksplorasi ditunjukkan bahwa sisaan model ARIMA(1,1,1) menyebar normal karena sebagian besar titik mengikuti garis diagonal pada QQ plot.  
Selain itu, plot sisaan memperlihatkan lebar pita fluktuasi yang relatif konstan, menandakan bahwa sisaan memiliki **ragam yang homogen**.  

Namun, dari plot ACF dan PACF sisaan model ARIMA(1,1,1) terlihat masih terdapat sedikit spike pada lag awal, yang mengindikasikan adanya kemungkinan autokorelasi lemah antar sisaan.  
Kondisi ini akan diuji lebih lanjut menggunakan **uji formal Ljung-Box** untuk memastikan apakah sisaan benar-benar saling bebas.

### Uji Formal

```{r}
#1) Sisaan Menyebar Normal
ks.test(sisaan.arima111, "pnorm")
```
H₀ : Sisaan menyebar normal  
H₁ : Sisaan tidak menyebar normal 

Berdasarkan hasil uji **Kolmogorov–Smirnov (KS)** terhadap sisaan model ARIMA(1,1,1), diperoleh p-value < 2.2e-16 yang lebih kecil dari taraf nyata 5% (0.05), sehingga secara formal **H₀ ditolak** dan sisaan **tidak menyebar normal**.

Namun, berdasarkan hasil eksplorasi menggunakan plot kuantil-kuantil normal (QQ plot), sebaran titik residual tampak mengikuti garis diagonal, yang menunjukkan bahwa **secara visual sisaan cenderung mendekati sebaran normal**.  

Perbedaan ini dapat disebabkan oleh sensitivitas uji KS terhadap ukuran sampel yang besar, sehingga kesimpulan praktis tetap dapat menyatakan bahwa **sisaan berdistribusi hampir normal dan dapat diterima untuk analisis lebih lanjut.**


```{r}
#2) Sisaan saling bebas/tidak ada autokorelasi
Box.test(sisaan.arima111, type = "Ljung")
```
H₀ : Sisaan saling bebas (tidak ada autokorelasi)  
H₁ : Sisaan tidak saling bebas (terdapat autokorelasi)

Berdasarkan hasil uji Ljung-Box, diperoleh **p-value = 0.8126**, yang lebih besar dari taraf nyata 5% (0.05).  
Dengan demikian, **gagal menolak H₀**, artinya **sisaan saling bebas atau tidak terdapat autokorelasi antar residual**.  

Hasil ini sejalan dengan eksplorasi menggunakan plot ACF dan PACF yang menunjukkan bahwa spike tidak signifikan, sehingga dapat disimpulkan bahwa model **ARIMA(1,1,1)** sudah memenuhi asumsi kebebasan sisaan.


```{r}
#3) Sisaan homogen
Box.test((sisaan.arima111)^2, type = "Ljung")
```
Uji ini dilakukan untuk memeriksa apakah **ragam sisaan homogen (konstan)** menggunakan **uji Ljung-Box terhadap sisaan kuadrat**.  
Hipotesis yang digunakan adalah:

H₀ : Ragam sisaan homogen  
H₁ : Ragam sisaan tidak homogen  

Berdasarkan hasil uji Ljung-Box terhadap sisaan kuadrat, diperoleh **p-value = 0.3686**, yang lebih besar dari taraf nyata 5% (0.05).  
Dengan demikian, **gagal menolak H₀**, artinya **ragam sisaan homogen atau konstan**.  

Hasil ini mendukung temuan dari eksplorasi visual, di mana fluktuasi sisaan tampak memiliki lebar pita yang relatif sama sepanjang waktu.


```{r}
#4) Nilai tengah sisaan sama dengan nol
t.test(sisaan.arima111, mu = 0, conf.level = 0.95)
```
Uji ini dilakukan untuk memastikan apakah **rataan (mean) sisaan sama dengan nol** menggunakan **uji t satu sampel**.  
Hipotesis yang diuji adalah sebagai berikut:

H₀ : Nilai tengah sisaan sama dengan 0  
H₁ : Nilai tengah sisaan tidak sama dengan 0  

Berdasarkan hasil uji t, diperoleh **p-value = 0.3881**, yang lebih besar dari taraf nyata 5% (0.05).  
Dengan demikian, **gagal menolak H₀**, artinya **nilai tengah sisaan tidak berbeda secara signifikan dari nol**.  

Hasil ini menunjukkan bahwa sisaan model **ARIMA(1,1,1)** memiliki rata-rata mendekati nol, sesuai dengan asumsi dasar model deret waktu yang baik.

## Overfitting
Tahapan selanjutnya adalah **uji overfitting**, yang dilakukan dengan menaikkan orde AR(p) dan MA(q) dari model-model kandidat sebelumnya untuk melihat apakah terdapat model lain yang lebih baik.  
Kandidat model overfitting yang diuji antara lain:
- ARIMA(2,1,1)
- ARIMA(1,1,2)
- ARIMA(2,1,2)

Setiap model dibandingkan berdasarkan nilai **AIC** dan **BIC**, serta signifikansi parameternya.  
Model dengan AIC dan BIC paling kecil serta seluruh parameter signifikan akan dipilih sebagai model terbaik.

```{r}
#---OVERFITTING---

# Overfitting dilakukan dengan menaikkan orde AR(p) dan MA(q)
# dari model terbaik yang telah diperoleh.

# Kandidat overfitting:
# 1) Naikkan orde AR dari ARIMA(1,1,1) → ARIMA(2,1,1)
model1a.arima <- Arima(data.train, order=c(2,1,1), method="ML")
summary(model1a.arima)
lmtest::coeftest(model1a.arima)

# 2) Naikkan orde MA dari ARIMA(1,1,1) → ARIMA(1,1,2)
model1b.arima <- Arima(data.train, order=c(1,1,2), method="ML")
summary(model1b.arima)
lmtest::coeftest(model1b.arima)

# 3) Naikkan keduanya dari ARIMA(1,1,1) → ARIMA(2,1,2)
model1c.arima <- Arima(data.train, order=c(2,1,2), method="ML")
summary(model1c.arima)
lmtest::coeftest(model1c.arima)

# Membandingkan nilai AIC dan BIC antar model
overfitting <- data.frame(
  Model = c("ARIMA(1,1,1)",
            "ARIMA(2,1,1)",
            "ARIMA(1,1,2)",
            "ARIMA(2,1,2)"),
  AIC = c(
    AIC(model3),
    AIC(model1a.arima),
    AIC(model1b.arima),
    AIC(model1c.arima)
  ),
  BIC = c(
    BIC(model3),
    BIC(model1a.arima),
    BIC(model1b.arima),
    BIC(model1c.arima)
  )
)

overfitting

```
Berdasarkan hasil overfitting di atas, model ARIMA(1,1,1) memiliki nilai AIC dan BIC terkecil dibandingkan dengan model-model kandidat lainnya (ARIMA(2,1,1), ARIMA(1,1,2), dan ARIMA(2,1,2)).
Nilai AIC = 1585.505 dan BIC = 1593.966 menunjukkan bahwa model ini paling efisien dalam menjelaskan variasi data dengan kompleksitas parameter yang relatif sederhana.

Model terbaik yang dipilih setelah proses overfitting adalah ARIMA(1,1,1) karena memiliki nilai AIC dan BIC terkecil, sehingga model ini digunakan untuk tahap peramalan selanjutnya.

## Peramalan

```{r}
#---MODEL TERBAIK---
model3.arima111 <- forecast::Arima(data.train, order = c(1,1,1), method = "ML")
summary(model3.arima111)

#---FORECAST---
ramalan <- forecast::forecast(model3.arima111, h = 30)
ramalan
```

```{r}
#---VISUALISASI HASIL PERAMALAN---
data.ramalan <- ramalan$mean
plot(ramalan, 
     main = "Peramalan 30 Periode ke Depan ARIMA(1,1,1)",
     xlab = "Waktu",
     ylab = "Nilai",
     col = "blue",
     lwd = 2)

```

Berdasarkan hasil peramalan menggunakan model ARIMA(1,1,1), diperoleh hasil prediksi untuk 30 periode ke depan. Garis biru pada grafik menunjukkan nilai ramalan (point forecast), sedangkan area abu-abu menunjukkan interval kepercayaan 80% dan 95% yang menggambarkan tingkat ketidakpastian dari hasil peramalan.
Pola peramalan menunjukkan bahwa nilai data cenderung stabil di sekitar rata-rata terakhir dari data historis, dengan rentang ketidakpastian yang semakin melebar seiring bertambahnya waktu ke depan. 
Hal ini menunjukkan bahwa model ARIMA(1,1,1) mampu mengikuti arah tren data sebelumnya,namun ketidakpastian prediksi meningkat pada periode yang lebih jauh.


```{r}
#---MODEL TERBAIK (NON-ZERO MEAN)---
model3.arima111 <- forecast::Arima(data.train, order = c(1,1,1), method = "ML", include.mean = TRUE)
summary(model3.arima111)
```

```{r}
#---FORECAST---
ramalan <- forecast::forecast(model3.arima111, h = 30)
ramalan

```

```{r}
#---VISUALISASI HASIL PERAMALAN---
data.ramalan <- ramalan$mean
plot(ramalan, 
     main = "Peramalan 30 Periode ke Depan ARIMA(1,1,1) dengan Non-Zero Mean",
     xlab = "Waktu",
     ylab = "Nilai",
     col = "blue",
     lwd = 2)

```

```{r}
#---PERBANDINGAN AKTUAL VS HASIL FORECAST---

# misalnya data.test adalah 30 nilai aktual terakhir (buat pembanding)
data.test <- tail(data$nilai, 30)

# ambil hasil forecast (mean)
data.ramalan <- ramalan$mean

# buat matriks perbandingan aktual vs forecast
perbandingan <- matrix(
  data = c(data.test, data.ramalan),
  nrow = length(data.ramalan),
  ncol = 2
)

# beri nama kolom dan ubah ke data frame
colnames(perbandingan) <- c("Aktual", "Hasil Forecast")
perbandingan <- as.data.frame(perbandingan)

# tampilkan 10 baris pertama
head(perbandingan, 10)

```

```{r}
#---AKURASI---
akurasi <- forecast::accuracy(data.ramalan, data.test)
akurasi

```
## Kesimpulan Akhir

Berdasarkan hasil pengujian akurasi, diperoleh nilai-nilai sebagai berikut:
 ME   = 337.9182
 RMSE = 443.7678
 MAE  = 360.4557
 MPE  = 2.083577
 MAPE = 2.228714

Nilai MAPE sebesar 2.23% menunjukkan bahwa tingkat kesalahan relatif model sangat kecil,artinya hasil peramalan memiliki ketepatan yang tinggi terhadap data aktual. Nilai RMSE dan MAE yang rendah juga memperkuat bahwa selisih antara nilai aktual dan hasil ramalan tidak terlalu besar secara absolut.

Dengan demikian, model ARIMA(1,1,1) dengan non-zero mean dapat dikatakan cukup baik dan akurat dalam memprediksi data pada 30 periode ke depan. Model ini mampu menangkap pola pergerakan data dengan deviasi kesalahan yang masih dalam batas wajar, sehingga layak digunakan untuk peramalan jangka pendek.
